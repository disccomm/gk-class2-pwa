<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GK Quiz ‚Äì Engine Validation</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f4f6f8;
}

header {
  background: #2563eb;
  color: #fff;
  padding: 14px;
  text-align: center;
  font-size: 20px;
  font-weight: 600;
}

.card {
  background: #fff;
  margin: 16px;
  padding: 16px;
  border-radius: 12px;
}

.progress {
  height: 6px;
  background: #e5e7eb;
  border-radius: 6px;
  overflow: hidden;
  margin: 8px 0 12px;
}

.progress-bar {
  height: 100%;
  background: #2563eb;
  width: 0%;
}

img {
  width: 100%;
  max-height: 220px;
  object-fit: contain;
  border-radius: 10px;
  background: #f1f1f1;
  margin-bottom: 12px;
}

.option {
  border: 1px solid #d1d5db;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 10px;
  cursor: pointer;
}

.option.correct { background: #dcfce7; border-color: #22c55e; }
.option.wrong { background: #fee2e2; border-color: #ef4444; }
.option.disabled { pointer-events: none; }

.row {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

button {
  flex: 1;
  padding: 12px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
}

.secondary { background: #e5e7eb; }
.primary { background: #2563eb; color: #fff; }
.disabled { opacity: 0.5; pointer-events: none; }

.exit {
  position: absolute;
  right: 20px;
  top: 16px;
  color: #2563eb;
  cursor: pointer;
}
</style>
</head>

<body>

<header>GK Quiz ‚Äì Engine Validation</header>

<div id="app"></div>

<script src="questionBank.js"></script>
<script>
let questions = [];
let index = 0;
let score = 0;
let answered = false;
let answers = [];

function shuffle(arr) {
  return arr.map(v => ({ v, r: Math.random() }))
            .sort((a,b)=>a.r-b.r)
            .map(x=>x.v);
}

function startQuiz(count) {
  questions = shuffle([...QUESTION_BANK]).slice(0, count).map(q => {
    const order = shuffle(q.options.map((o,i)=>({o,i})));
    return {
      ...q,
      shuffled: order,
      correct: order.findIndex(x=>x.i===q.correctIndex)
    };
  });
  index = 0; score = 0; answers = [];
  render();
}

function render() {
  const q = questions[index];
  const progress = ((index+1)/questions.length)*100;

  document.getElementById("app").innerHTML = `
    <div class="card">
      <div class="exit" onclick="finish()">Exit ‚úï</div>
      <div>Question ${index+1} of ${questions.length}</div>
      <div class="progress"><div class="progress-bar" style="width:${progress}%"></div></div>
      <div><strong>${q.question}</strong></div>
      ${q.imageUrl ? `<img src="${q.imageUrl}" onerror="this.style.display='none'">` : ``}

      ${q.shuffled.map((x,i)=>`
        <div class="option" onclick="select(${i})">${String.fromCharCode(65+i)}. ${x.o}</div>
      `).join("")}

      <div class="row">
        <button class="secondary" id="clearBtn" onclick="clearAnswer()">üßΩ Clear</button>
        <button class="secondary" onclick="skip()">‚è≠ Skip</button>
      </div>

      <div class="row">
        <button class="secondary ${index===0?'disabled':''}" onclick="prev()">‚Üê Previous</button>
        <button class="primary disabled" id="nextBtn" onclick="next()">
          ${index===questions.length-1 ? 'Finish Quiz' : 'Next ‚Üí'}
        </button>
      </div>
    </div>
  `;
  answered = false;
}

function select(i) {
  if (answered) return;
  answered = true;
  const q = questions[index];
  const opts = document.querySelectorAll('.option');

  opts.forEach(o=>o.classList.add('disabled'));
  document.getElementById("clearBtn").classList.add("disabled");
  document.getElementById("nextBtn").classList.remove("disabled");

  if (i === q.correct) {
    opts[i].classList.add('correct');
    score++;
    answers.push({q:q.question, correct:true});
  } else {
    opts[i].classList.add('wrong');
    opts[q.correct].classList.add('correct');
    answers.push({q:q.question, correct:false});
  }
}

function clearAnswer() {
  if (answered) return;
  render();
}

function next() {
  if (index === questions.length-1) return finish();
  index++;
  render();
}

function prev() {
  if (index===0) return;
  index--;
  render();
}

function skip() {
  answers.push({q:questions[index].question, correct:null});
  next();
}

function finish() {
  document.getElementById("app").innerHTML = `
    <div class="card">
      <h3>Quiz Summary</h3>
      <p>Score: ${score} / ${questions.length}</p>
      <p>Correct: ${answers.filter(a=>a.correct).length}</p>
      <p>Incorrect: ${answers.filter(a=>a.correct===false).length}</p>
      <p>Skipped: ${answers.filter(a=>a.correct===null).length}</p>
      <p>Percentage: ${Math.round((score/questions.length)*100)}%</p>
      <button class="primary" onclick="location.reload()">Restart</button>
    </div>
  `;
}

document.getElementById("app").innerHTML = `
  <div class="card">
    <h3>How many questions?</h3>
    <label><input type="radio" name="q" value="5" checked> 5</label><br>
    <label><input type="radio" name="q" value="10"> 10</label><br><br>
    <button class="primary" onclick="startQuiz(document.querySelector('input[name=q]:checked').value)">Start Quiz</button>
  </div>
`;
</script>
</body>
</html>