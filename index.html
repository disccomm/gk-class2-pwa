<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GK Quiz – Engine Validation</title>

<style>
  body { font-family: system-ui, -apple-system, BlinkMacSystemFont; margin: 0; background:#f4f7fb; }
  header { background:#2563eb; color:#fff; padding:16px; text-align:center; font-size:20px; }
  .card { background:#fff; margin:16px; padding:16px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.08); }
  .progress { height:6px; background:#e5e7eb; border-radius:4px; overflow:hidden; margin:8px 0; }
  .progress-bar { height:100%; background:#2563eb; width:0%; }
  img { max-width:100%; border-radius:10px; margin:10px 0; }
  .option { border:1px solid #d1d5db; padding:12px; border-radius:10px; margin:8px 0; cursor:pointer; }
  .option.correct { background:#dcfce7; border-color:#22c55e; }
  .option.wrong { background:#fee2e2; border-color:#ef4444; }
  .controls { display:flex; gap:8px; margin-top:12px; }
  .controls button { flex:1; padding:12px; border:none; border-radius:10px; font-size:16px; }
  .primary { background:#2563eb; color:white; }
  .secondary { background:#e5e7eb; }
</style>
</head>

<body>
<header>GK Quiz – Engine Validation</header>

<div id="app" class="card"></div>

<script type="module">
import QUESTION_BANK from './questionBank.js';

let questions = [];
let index = 0;
let answers = {};

function shuffle(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function startQuiz(count) {
  questions = shuffle(QUESTION_BANK).slice(0, count);
  index = 0;
  answers = {};
  renderQuestion();
}

function renderQuestion() {
  const q = questions[index];
  const app = document.getElementById('app');
  const progress = Math.round(((index+1)/questions.length)*100);

  app.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Question ${index+1} of ${questions.length}</strong>
      <button class="secondary" onclick="showSummary()">Exit ×</button>
    </div>

    <div class="progress"><div class="progress-bar" style="width:${progress}%"></div></div>

    <h3>${q.text}</h3>
    ${q.image ? `<img src="${q.image}" alt="question image">` : ''}

    ${q.options.map((o,i)=>`
      <div class="option" onclick="selectAnswer(${i})">${String.fromCharCode(65+i)}. ${o}</div>
    `).join('')}

    <div class="controls">
      <button class="secondary" onclick="clearAnswer()">Clear</button>
      <button class="secondary" onclick="skip()">Skip</button>
    </div>

    <div class="controls">
      <button class="secondary" ${index===0?'disabled':''} onclick="prev()">← Previous</button>
      <button class="primary" ${answers[index]==null?'disabled':''}
        onclick="${index===questions.length-1?'finish()':'next()'}">
        ${index===questions.length-1?'Finish Quiz':'Next →'}
      </button>
    </div>
  `;
}

window.selectAnswer = function(i){
  answers[index] = i;
  document.querySelectorAll('.option').forEach((el,idx)=>{
    el.classList.remove('correct','wrong');
    if(idx===i){
      el.classList.add(idx===questions[index].correctIndex?'correct':'wrong');
    }
  });
  renderQuestion();
}

window.clearAnswer = ()=>{ delete answers[index]; renderQuestion(); }
window.skip = ()=>{ next(); }
window.next = ()=>{ index++; renderQuestion(); }
window.prev = ()=>{ index--; renderQuestion(); }

window.finish = showSummary;

function showSummary(){
  let correct=0, skipped=0;
  const app=document.getElementById('app');

  const review = questions.map((q,i)=>{
    const a=answers[i];
    if(a==null) skipped++;
    else if(a===q.correctIndex) correct++;
    return `
      <p><strong>Q${i+1}:</strong> ${q.text}<br>
      Your answer: ${a!=null?q.options[a]:'Skipped'}<br>
      Correct: ${q.options[q.correctIndex]} (PDF page ${q.sourcePage})</p><hr>
    `;
  }).join('');

  app.innerHTML=`
    <h2>Quiz Review</h2>
    ${review}
    <h3>Score: ${correct}/${questions.length}</h3>
    <button class="primary" onclick="location.reload()">Restart</button>
  `;
}

document.getElementById('app').innerHTML = `
  <h3>How many questions?</h3>
  <label><input type="radio" name="q" value="5"> 5</label><br>
  <label><input type="radio" name="q" value="10" checked> 10</label><br><br>
  <button class="primary" onclick="startQuiz(Number(document.querySelector('input[name=q]:checked').value))">
    Start Quiz
  </button>
`;
</script>
</body>
</html>